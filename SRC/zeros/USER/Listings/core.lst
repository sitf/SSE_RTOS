


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000 E000ED04 
                       NVIC_INT_CTRL
                               EQU              0xE000ED04  ; ÖÐ¶Ï¿ØÖÆ¼Ä´æÆ÷
    3 00000000 E000ED22 
                       NVIC_SYSPRI14
                               EQU              0xE000ED22  ; ÏµÍ³ÓÅÏÈ¼¶¼Ä´æÆ÷(
                                                            ÓÅÏÈ¼¶14).
    4 00000000 000000FF 
                       NVIC_PENDSV_PRI
                               EQU              0xFF        ; PendSVÓÅÏÈ¼¶(×îµÍ
                                                            ).
    5 00000000 10000000 
                       NVIC_PENDSVSET
                               EQU              0x10000000  ; PendSV´¥·¢Öµ
    6 00000000         
    7 00000000                 PRESERVE8                    ;8×Ö½Ú¶ÔÆë£¿
    8 00000000                 THUMB
    9 00000000         
   10 00000000                 AREA             CODE, CODE, READONLY
   11 00000000         
   12 00000000                 EXTERN           CPU_ExceptStkBase ;Ö÷¶ÑÕ»
   13 00000000         
   14 00000000                 EXTERN           p_TCB_Cur   ;Ö¸ÏòTCBµÄµÄÖ¸Õë
   15 00000000                 EXTERN           p_TCBHightRdy ;Ö¸Ïò×î¸ßÓÅÏÈ¼¶ÈÎ
                                                            ÎñµÄÖ¸Õë
   16 00000000         
   17 00000000                 EXPORT           OSStartHighRdy
   18 00000000                 EXPORT           PendSV_Handler 
                                                            ;PendSVÒì³£´¦Àíº¯Êý
                                                            
   19 00000000                 EXPORT           OSCtxSw
   20 00000000                 EXPORT           OS_CPU_SR_Save
   21 00000000                 EXPORT           OS_CPU_SR_Restore
   22 00000000         
   23 00000000         ; ARMÎ¢´¦ÀíÆ÷Ö§³Ö¼ÓÔØ/´æ´¢Ö¸ÁîÓÃÓÚÔÚ¼Ä´æÆ÷ºÍ´æ´¢Æ÷Ö®¼ä´«
                       ËÍÊý¾Ý£¬¼ÓÔØÖ¸ÁîÓÃÓÚ½«´æ´¢Æ÷ÖÐµÄÊý¾Ý´«ËÍµ½¼Ä´æÆ÷£¬´æ´¢Ö¸
                       ÁîÔòÍê³ÉÏà·´µÄ²Ù×÷¡£³£ÓÃµÄ¼ÓÔØ´æ´¢Ö¸ÁîÈçÏÂ£º
   24 00000000         ; ¡ª  LDR     ×ÖÊý¾Ý¼ÓÔØÖ¸Áî
   25 00000000         ; ¡ª  LDRB    ×Ö½ÚÊý¾Ý¼ÓÔØÖ¸Áî
   26 00000000         ; ¡ª  LDRH    °ë×ÖÊý¾Ý¼ÓÔØÖ¸Áî
   27 00000000         ; ¡ª  STR     ×ÖÊý¾Ý´æ´¢Ö¸Áî
   28 00000000         ; ¡ª  STRB    ×Ö½ÚÊý¾Ý´æ´¢Ö¸Áî
   29 00000000         ; ¡ª  STRH    °ë×ÖÊý¾Ý´æ´¢Ö¸Áî
   30 00000000         
   31 00000000         OS_CPU_SR_Save                       ;PRIMASK   ÕâÊÇ¸öÖ»
                                                            ÓÐµ¥Ò»±ÈÌØµÄ¼Ä´æÆ÷¡
                                                            £ÔÚËü±»ÖÃ1ºó£¬¾Í¹Øµ
                                                            ôËùÓÐ¿ÉÆÁ±ÎµÄÒì³££¬
                                                            Ö»Ê£ÏÂNMIºÍÓ²fault¿
                                                            ÉÒÔÏìÓ¦¡£ËüµÄÈ±Ê¡Öµ
                                                            ÊÇ0£¬±íÊ¾Ã»ÓÐ¹ØÖÐ¶Ï
                                                            
   32 00000000 F3EF 8010       MRS              R0, PRIMASK ;¶ÁÈ¡PRIMASKµ½R0,R0
                                                            Îª·µ»ØÖµ 
   33 00000004 B672            CPSID            I           ;PRIMASK=1,¹ØÖÐ¶Ï(N
                                                            MIºÍÓ²¼þFAULT¿ÉÒÔÏì
                                                            Ó¦)
   34 00000006 4770            BX               LR          ;·µ»Ø



ARM Macro Assembler    Page 2 


   35 00000008         
   36 00000008         OS_CPU_SR_Restore
   37 00000008 F380 8810       MSR              PRIMASK, R0 ;¶ÁÈ¡R0µ½PRIMASKÖÐ,
                                                            R0Îª²ÎÊý
   38 0000000C 4770            BX               LR          ;·µ»Ø
   39 0000000E         
   40 0000000E         OSCtxSw
   41 0000000E 4816            LDR              R0,=NVIC_INT_CTRL
   42 00000010 F04F 5180       LDR              R1,=NVIC_PENDSVSET
   43 00000014 6001            STR              R1,[R0]     ;´¥·¢PendSV
   44 00000016 4770            BX               LR
   45 00000018         
   46 00000018         
   47 00000018         
   48 00000018         
   49 00000018         ; @*****************************************************
                       ***************************************************
   50 00000018         ; @                                         START MULTIT
                       ASKING
   51 00000018         ; @                                      void OSStartHig
                       hRdy(void)
   52 00000018         ; @
   53 00000018         ; @ Note(s) : 1) This function triggers a PendSV excepti
                       on (essentially, causes a context switch) to cause
   54 00000018         ; @              the first task to start.
   55 00000018         ; @
   56 00000018         ; @           2) OSStartHighRdy() MUST:
   57 00000018         ; @              a) Setup PendSV exception priority to l
                       owest;
   58 00000018         ; @              b) Set initial PSP to 0, to tell contex
                       t switcher this is first run;
   59 00000018         ; @              c) Set the main stack to OS_CPU_ExceptS
                       tkBase
   60 00000018         ; @              d) Trigger PendSV exception;
   61 00000018         ; @              e) Enable interrupts (tasks will run wi
                       th interrupts enabled).
   62 00000018         ; @*****************************************************
                       ***************************************************
   63 00000018         OSStartHighRdy                       ; ÉèÖÃPendSVµÄÒì³£Ö
                                                            Ð¶ÏÓÅÏÈ¼¶
   64 00000018         ;LDR{Ìõ¼þ}   Ä¿µÄ¼Ä´æÆ÷     <´æ´¢Æ÷µØÖ·>
   65 00000018         ;×÷ÓÃ£º½« ´æ´¢Æ÷µØÖ· ËùÖ¸µØÖ·´¦Á¬ÐøµÄ4¸ö×Ö½Ú£¨1¸ö×Ö£©µÄÊ
                       ý¾Ý´«ËÍµ½Ä¿µÄ¼Ä´æÆ÷ÖÐ¡£
   66 00000018         ;NVIC_SYSPRI14      EQU     0xE000ED22; ÏµÍ³ÓÅÏÈ¼¶¼Ä´æÆ÷
                       (ÓÅÏÈ¼¶14).
   67 00000018         ;NVIC_PENDSV_PRI     EQU        0xFF; PendSVÓÅÏÈ¼¶(×îµÍ)
                       .
   68 00000018         
   69 00000018         
   70 00000018         ;ÍùNVICÓÅÏÈ¼¶¿ØÖÆ¼Ä´æÆ÷ÀïÐ´ÓÅÏÈ¼¶£¬¶¨Òå³É×îµÍÓÅÏÈ¼¶£¨0xf
                       f£©
   71 00000018 4814            LDR              R0,=NVIC_SYSPRI14
   72 0000001A F04F 01FF       LDR              R1,=NVIC_PENDSV_PRI
   73 0000001E 7001            STRB             R1,[R0]     ;½«¼Ä´æÆ÷R1ÖÐµÄ×Ö½Ú
                                                            Êý¾ÝÐ´ÈëÒÔR0ÎªµØÖ·µ
                                                            Ä´æ´¢Æ÷ÖÐ¡£
   74 00000020         
   75 00000020 2000            MOVS             R0,#0       ;ÈÎÎñ¶ÑÕ»ÉèÖÃÎª0
   76 00000022 F380 8809       MSR              PSP,R0      ;PSPÇåÁã£¬×÷ÎªÊ×´ÎÉ



ARM Macro Assembler    Page 3 


                                                            ÏÏÂÎÄÇÐ»»µÄ±êÖ¾
   77 00000026         
   78 00000026 4812            LDR              R0,=CPU_ExceptStkBase ;³õÊ¼»¯¶Ñ
                                                            Õ»ÎªCPU_ExceptStkBa
                                                            se
   79 00000028 6801            LDR              R1,[R0]     ;R1µÄÊý¾Ý+R2µÄÊý¾Ýº
                                                            Ï³ÉÒ»¸öµØÖ·Öµ£¬¸ÃµØ
                                                            Ö·ÖÐ´æ·ÅµÄÊý¾Ý¸³Öµ¸
                                                            øR0
   80 0000002A F381 8808       MSR              MSP,R1      ;½«MSPÉèÎªÎÒÃÇÎªÆä·
                                                            ÖÅäµÄÄÚ´æµØÖ·CPU_Ex
                                                            ceptStkBase
   81 0000002E         
   82 0000002E         ;ÍùNVIC_INT_CTRL(0xE000ED04; ÖÐ¶Ï¿ØÖÆ¼Ä´æÆ÷)µÚ28Î»Ð´1£¬¼
                       ´¿É½«PendSVÒì³£¹ÒÆð¡£ÈôÊÇµ±Ç°Ã»ÓÐ¸ßÓÅÏÈ¼¶ÖÐ¶Ï²úÉú£¬ÄÇÃ´³
                       ÌÐò½«»á½øÈëPendSV handler
   83 0000002E 480E            LDR              R0,=NVIC_INT_CTRL
   84 00000030 F04F 5180       LDR              R1,=NVIC_PENDSVSET
   85 00000034 6001            STR              R1,[R0]     ; ´¥·¢PendSVÒì³£
   86 00000036         
   87 00000036 B662            CPSIE            I           ;¿ªÆôÖÐ¶Ï
   88 00000038         
   89 00000038         
   90 00000038         
   91 00000038         
   92 00000038         
   93 00000038         
   94 00000038         PendSV_Handler
   95 00000038 B672            CPSID            I           ; ¹ØÖÐ¶Ï
   96 0000003A F3EF 8009       MRS              R0,PSP      ;°ÑPSPÖ¸ÕëµÄÖµ¸³¸øR
                                                            0
   97 0000003E B128            CBZ              R0,OS_CPU_PendSV_Handler_nosave
 
                                                            ;Èç¹ûPSPÎª0µ÷µ½OS_C
                                                            PU_PendSV_Handler_n
                                                            osave
   98 00000040         
   99 00000040 3820            SUBS             R0,R0,#0x20
  100 00000042 E880 0FF0       STM              R0,{R4-R11} ; ÈëÕ»R4-R11£»°ÑR4-
                                                            R11±£´æµ½¶ÑÕ»£¨spÖ¸
                                                            ÏòµÄµØÖ·£©ÖÐ¡£
  101 00000046         
  102 00000046 490B            LDR              R1,=p_TCB_Cur ;ÔÚÕâÀïÎÒÃÇÈëÕ»ÁË
                                                            ºÜ¶à¼Ä´æÆ÷  ;µ±Ç°ÈÎ
                                                            ÎñµÄÖ¸Õë
  103 00000048 6809            LDR              R1,[R1]     ;ÕâÈý¾äÈÃp_TCB_Cur-
                                                            >StkPtrÖ¸ÏòÐÂµÄÕ»¶¥
                                                            
  104 0000004A 6008            STR              R0,[R1]     ;¼´p_TCB_Cur->StkPt
                                                            r=SP
  105 0000004C         
  106 0000004C         OS_CPU_PendSV_Handler_nosave
  107 0000004C 4809            LDR              R0,=p_TCB_Cur ;p_TCB_Cur=p_TCBH
                                                            ightRdy
  108 0000004E 490A            LDR              R1,=p_TCBHightRdy
  109 00000050 680A            LDR              R2,[R1]
  110 00000052 6002            STR              R2,[R0]     ;½«R2µÄÖµÐ´Èëµ½¡¾R0
                                                            ¡¿µÄµØÖ·ÖÐ
  111 00000054         



ARM Macro Assembler    Page 4 


  112 00000054 6810            LDR              R0,[R2]     ;½«ÐÂµÄÕ»¶¥¸øSP,SP=
                                                            p_TCB_Cur->StkPtr
  113 00000056         
  114 00000056 E890 0FF0       LDM              R0,{R4-R11} ; µ¯³öR4-R11
  115 0000005A 3020            ADDS             R0,R0,#0x20
  116 0000005C         
  117 0000005C F380 8809       MSR              PSP,R0      ;¸üÐÂPSP;ÓÐÁ½¸ö¶ÑÕ»
                                                            ¼Ä´æÆ÷£¬Ö÷¶ÑÕ»Ö¸Õë£
                                                            ¨MSP£©Óë½ø³Ì¶ÑÕ»Ö¸Õ
                                                            ë£¨PSP£©£¬¶øÇÒÈÎÒ»Ê
                                                            ±¿ÌÖ»ÄÜÊ¹ÓÃÆäÖÐµÄÒ»
                                                            ¸ö¡£MSPÎª¸´Î»ºóÈ±Ê¡
                                                            Ê¹ÓÃµÄ¶ÑÕ»Ö¸Õë£¬Òì³
                                                            £ÓÀÔ¶Ê¹ÓÃMSP£¬Èç¹ûÊ
                                                            Ö¶¯¿ªÆôPSP£¬ÄÇÃ´Ïß³
                                                            ÌÊ¹ÓÃPSP£¬·ñÔòÒ²Ê¹Ó
                                                            ÃMSP¡£ÔõÃ´¿ªÆôPSP£¿
                                                            
  118 00000060 F04E 0E04       ORR              LR,LR,#0x04 ;ÖÃLRµÄÎ»2Îª1£¬ÄÇÃ´
                                                            Òì³£·µ»Øºó£¬Ïß³ÌÊ¹Ó
                                                            ÃPSP
  119 00000064         
  120 00000064 B662            CPSIE            I           ;¿ªÖÐ¶Ï
  121 00000066         ;Í¨³£Ò»¸öº¯Êýµ÷ÓÃÁíÒ»¸öº¯ÊýÊ±»áÊ¹ÓÃBLÖ¸Áî£¬Õâ¸öÖ¸Áî»á°Ñµ
                       ±Ç°µÄPC·Åµ½LR¼Ä´æÆ÷
  122 00000066 4770            BX               LR          ;°ÑLR¼Ä´æÆ÷µÄÄÚÈÝ¸´
                                                            ÖÆµ½PC¼Ä´æÆ÷Àï £¬´Ó
                                                            ¶øÊµÏÖº¯ÊýµÄ·µ»Ø
  123 00000068         ;ÔÚÖÐ¶Ï³öÏÖÊ±£¬LR¼Ä´æÆ÷»áÉèÎªÒ»¸öÌØÊâµÄÖµ£¨º¯Êý·µ»ØµØÖ·£
                       ©£¬¶ø²»ÊÇÖÐ¶ÏÖ®Ç°µÄPC¼Ä´æÆ÷ÄÚÈÝ£¬ÕâÑù£¬µ±ÖÐ¶Ïº¯ÊýÊ¹ÓÃBX 
                       LRÖ¸Áî·µ»ØÊ± £¬CPU¾ÍÄÜ¹»ÖªµÀÊÇÖÐ¶Ïº¯Êý·µ»ØÁË
  124 00000068         
  125 00000068                 END
              E000ED04 
              E000ED22 
              00000000 
              00000000 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --apcs=interw
ork --depend=.\objects\core.d -o.\objects\core.o -IC:\Users\heyuan\Desktop\zero
s\USER\RTE -ID:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\2.2.0\Device\Include -ID:\K
eil_v5\ARM\CMSIS\Include --predefine="__UVISION_VERSION SETA 521" --predefine="
STM32F10X_HD SETA 1" --list=.\listings\core.lst ..\OS\core.asm



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

CODE 00000000

Symbol: CODE
   Definitions
      At line 10 in file ..\OS\core.asm
   Uses
      None
Comment: CODE unused
OSCtxSw 0000000E

Symbol: OSCtxSw
   Definitions
      At line 40 in file ..\OS\core.asm
   Uses
      At line 19 in file ..\OS\core.asm
Comment: OSCtxSw used once
OSStartHighRdy 00000018

Symbol: OSStartHighRdy
   Definitions
      At line 63 in file ..\OS\core.asm
   Uses
      At line 17 in file ..\OS\core.asm
Comment: OSStartHighRdy used once
OS_CPU_PendSV_Handler_nosave 0000004C

Symbol: OS_CPU_PendSV_Handler_nosave
   Definitions
      At line 106 in file ..\OS\core.asm
   Uses
      At line 97 in file ..\OS\core.asm
Comment: OS_CPU_PendSV_Handler_nosave used once
OS_CPU_SR_Restore 00000008

Symbol: OS_CPU_SR_Restore
   Definitions
      At line 36 in file ..\OS\core.asm
   Uses
      At line 21 in file ..\OS\core.asm
Comment: OS_CPU_SR_Restore used once
OS_CPU_SR_Save 00000000

Symbol: OS_CPU_SR_Save
   Definitions
      At line 31 in file ..\OS\core.asm
   Uses
      At line 20 in file ..\OS\core.asm
Comment: OS_CPU_SR_Save used once
PendSV_Handler 00000038

Symbol: PendSV_Handler
   Definitions
      At line 94 in file ..\OS\core.asm
   Uses
      At line 18 in file ..\OS\core.asm
Comment: PendSV_Handler used once
7 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

NVIC_INT_CTRL E000ED04

Symbol: NVIC_INT_CTRL
   Definitions
      At line 2 in file ..\OS\core.asm
   Uses
      At line 41 in file ..\OS\core.asm
      At line 83 in file ..\OS\core.asm

NVIC_PENDSVSET 10000000

Symbol: NVIC_PENDSVSET
   Definitions
      At line 5 in file ..\OS\core.asm
   Uses
      At line 42 in file ..\OS\core.asm
      At line 84 in file ..\OS\core.asm

NVIC_PENDSV_PRI 000000FF

Symbol: NVIC_PENDSV_PRI
   Definitions
      At line 4 in file ..\OS\core.asm
   Uses
      At line 72 in file ..\OS\core.asm
Comment: NVIC_PENDSV_PRI used once
NVIC_SYSPRI14 E000ED22

Symbol: NVIC_SYSPRI14
   Definitions
      At line 3 in file ..\OS\core.asm
   Uses
      At line 71 in file ..\OS\core.asm
Comment: NVIC_SYSPRI14 used once
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

CPU_ExceptStkBase 00000000

Symbol: CPU_ExceptStkBase
   Definitions
      At line 12 in file ..\OS\core.asm
   Uses
      At line 78 in file ..\OS\core.asm
Comment: CPU_ExceptStkBase used once
p_TCBHightRdy 00000000

Symbol: p_TCBHightRdy
   Definitions
      At line 15 in file ..\OS\core.asm
   Uses
      At line 108 in file ..\OS\core.asm
Comment: p_TCBHightRdy used once
p_TCB_Cur 00000000

Symbol: p_TCB_Cur
   Definitions
      At line 14 in file ..\OS\core.asm
   Uses
      At line 102 in file ..\OS\core.asm
      At line 107 in file ..\OS\core.asm

3 symbols
348 symbols in table
